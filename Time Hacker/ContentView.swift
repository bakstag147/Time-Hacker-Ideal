import SwiftUI

struct ContentView: View {
    @StateObject private var levelManager = LevelManager()
    @State private var showGame = false
    @State private var startLevel = 1
    
    var body: some View {
        ZStack {  // –ó–∞–º–µ–Ω—è–µ–º Group –Ω–∞ ZStack
            if showGame {
                GameView(startingLevel: startLevel, levelManager: levelManager)
            } else {
                MainMenuView(
                    levelManager: levelManager,
                    startGame: {
                        startLevel = 1
                        showGame = true
                    },
                    selectLevel: { selectedLevel in
                        startLevel = selectedLevel
                        showGame = true
                    }
                )
            }
        }
    }
}

struct MainMenuView: View {
    @ObservedObject var levelManager: LevelManager
    let startGame: () -> Void
    let selectLevel: (Int) -> Void
    @State private var showLevelSelect = false
    @State private var showAboutGame = false
    
    var body: some View {
        VStack(spacing: 30) {
            Text("Time Hacker")
                .font(.system(size: 40, weight: .bold))
                .foregroundColor(.blue)
            
            VStack(spacing: 16) {
                Button(action: startGame) {
                    MenuButton(title: "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É", systemImage: "play.fill")
                }
                
                Button(action: { showLevelSelect = true }) {
                    MenuButton(title: "–í—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å", systemImage: "list.number")
                }
                
                Button(action: { showAboutGame = true }) {
                    MenuButton(title: "–û–± –∏–≥—Ä–µ", systemImage: "info.circle")
                }
            }
        }
        .padding()
        .sheet(isPresented: $showLevelSelect) {
            LevelSelectView(
                levelManager: levelManager,  // –ø–µ—Ä–µ–¥–∞–µ–º levelManager
                startGame: selectLevel
            )
        }
        .sheet(isPresented: $showAboutGame) {
            AboutGameView()
        }
    }
}

struct AboutGameView: View {
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        NavigationView {
            ScrollView {
                VStack(alignment: .leading, spacing: 20) {
                    Text("–û Time Hacker")
                        .font(.title)
                        .bold()
                    
                    Group {
                        Text("–û–ø–∏—Å–∞–Ω–∏–µ")
                            .font(.headline)
                        Text("Time Hacker - —ç—Ç–æ –∏–≥—Ä–∞ –æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ —É–±–µ–∂–¥–µ–Ω–∏—è. –ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π—Ç–µ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ —ç–ø–æ—Ö–∏, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞–≤—ã–∫–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å–≤–æ–∏—Ö —Ü–µ–ª–µ–π.")
                    }
                    
                    Group {
                        Text("–ö–∞–∫ –∏–≥—Ä–∞—Ç—å")
                            .font(.headline)
                        Text("‚Ä¢ –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –¥–∏–∞–ª–æ–≥ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —ç–ø–æ—Ö–∏\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–±–µ–∂–¥–µ–Ω–∏–µ, –∑–Ω–∞–Ω–∏—è –∏ —Ö–∏—Ç—Ä–æ—Å—Ç—å, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏\n‚Ä¢ –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ —Ä–µ–∞–∫—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞\n‚Ä¢ –ü–æ–±–µ–¥–∏—Ç–µ, –Ω–∞–π–¥—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É")
                    }
                    
                    Group {
                        Text("–£—Ä–æ–≤–Ω–∏")
                            .font(.headline)
                        Text("–ò–≥—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —É—Ä–æ–≤–Ω–µ–π, –∫–∞–∂–¥—ã–π –≤ —Å–≤–æ–µ–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π —ç–ø–æ—Ö–µ:\n1. –ó–∞—Ä—è –ß–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞\n2. –î—Ä–µ–≤–Ω–∏–π –ï–≥–∏–ø–µ—Ç\n3. –î—Ä–µ–≤–Ω—è—è –ì—Ä–µ—Ü–∏—è\n4. –†–∏–º—Å–∫–∞—è –ò–º–ø–µ—Ä–∏—è\n5. –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–π –ö–∏—Ç–∞–π\n6. –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è –ï–≤—Ä–æ–ø–∞\n7. –≠–ø–æ—Ö–∞ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è\n8. –≠–ø–æ—Ö–∞ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è\n9. –ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–∞—è –≠–ø–æ—Ö–∞\n10. –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å")
                    }
                    
                    Group {
                        Text("–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏")
                            .font(.headline)
                        Text("–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –≤—Å–µ—Ö –ª—é–±–∏—Ç–µ–ª–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏")
                    }
                }
                .padding()
            }
            .navigationBarItems(trailing: Button("–ó–∞–∫—Ä—ã—Ç—å") {
                dismiss()
            })
        }
    }
}

struct MenuButton: View {
    let title: String
    let systemImage: String
    
    var body: some View {
        HStack {
            Image(systemName: systemImage)
                .font(.title2)
            Text(title)
                .font(.title2)
                .fontWeight(.semibold)
        }
        .foregroundColor(.white)
        .frame(width: 250)
        .padding()
        .background(Color.blue)
        .cornerRadius(15)
    }
}

struct LevelSelectView: View {
    @Environment(\.dismiss) private var dismiss
    @ObservedObject var levelManager: LevelManager
    let startGame: (Int) -> Void
    
    private let columns = [
        GridItem(.flexible()),
        GridItem(.flexible()),
        GridItem(.flexible())
    ]
    
    var body: some View {
        NavigationView {
            ZStack {
                Color.black.edgesIgnoringSafeArea(.all)
                
                ScrollView {
                    VStack(alignment: .leading) {
                        Text("Time Hacker")
                            .font(.system(size: 40, weight: .bold))
                            .foregroundColor(.white)
                            .padding(.horizontal)
                            .padding(.top)
                        
                        LazyVGrid(columns: columns, spacing: 15) {
                            ForEach(1...10, id: \.self) { level in
                                Button(action: {
                                    if levelManager.isLevelUnlocked(level) {
                                        startGame(level)
                                        dismiss()
                                    }
                                }) {
                                    VStack(spacing: 8) {
                                        ZStack {
                                            Image(uiImage: UIImage(named: "bgLevel\(level)") ?? UIImage(systemName: "photo.fill")!)
                                                .resizable()
                                                .aspectRatio(contentMode: .fill)
                                                .frame(width: UIScreen.main.bounds.width / 3.5, height: 140)
                                                .clipped()
                                                .cornerRadius(15)
                                                .overlay(
                                                    RoundedRectangle(cornerRadius: 15)
                                                        .fill(Color.black.opacity(levelManager.isLevelUnlocked(level) ? 0 : 0.7))
                                                )
                                                .overlay(
                                                    LinearGradient(
                                                        gradient: Gradient(colors: [.clear, .black.opacity(0.5)]),
                                                        startPoint: .top,
                                                        endPoint: .bottom
                                                    )
                                                    .cornerRadius(15)
                                                )
                                            
                                            if !levelManager.isLevelUnlocked(level) {
                                                Image(systemName: "lock.fill")
                                                    .font(.system(size: 30, weight: .bold))
                                                    .foregroundColor(.white)
                                                    .shadow(radius: 5)
                                            }
                                            
                                            VStack {
                                                Spacer()
                                                Text("–£—Ä–æ–≤–µ–Ω—å \(level)")
                                                    .font(.system(size: 16, weight: .semibold))
                                                    .foregroundColor(.white)
                                                    .padding(.bottom, 10)
                                                    .shadow(radius: 5)
                                            }
                                        }
                                    }
                                }
                                .disabled(!levelManager.isLevelUnlocked(level))
                            }
                        }
                        .padding(.horizontal, 10)
                    }
                }
            }
            .navigationBarTitleDisplayMode(.inline)
            .navigationBarItems(trailing: Button(action: {
                dismiss()
            }) {
                Image(systemName: "xmark.circle.fill")
                    .font(.title2)
                    .foregroundColor(.white)
            })
        }
    }
    
    private func getLevelTitle(_ level: Int) -> String {
        switch level {
        case 1: return "–ó–∞—Ä—è –ß–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞"
        case 2: return "–î—Ä–µ–≤–Ω–∏–π –ï–≥–∏–ø–µ—Ç"
        case 3: return "–î—Ä–µ–≤–Ω—è—è –ì—Ä–µ—Ü–∏—è"
        case 4: return "–†–∏–º—Å–∫–∞—è –ò–º–ø–µ—Ä–∏—è"
        case 5: return "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–π –ö–∏—Ç–∞–π"
        case 6: return "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è –ï–≤—Ä–æ–ø–∞"
        case 7: return "–≠–ø–æ—Ö–∞ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è"
        case 8: return "–≠–ø–æ—Ö–∞ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è"
        case 9: return "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–∞—è –≠–ø–æ—Ö–∞"
        case 10: return "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å"
        default: return ""
        }
    }
}

// MARK: - Models
enum MessageType {
    case message
    case status
    case victory
}

struct Message: Identifiable, Equatable {
    let id = UUID()
    let content: String
    let isUser: Bool
    let type: MessageType
    let timestamp = Date()
    
    static func == (lhs: Message, rhs: Message) -> Bool {
        lhs.id == rhs.id &&
        lhs.content == rhs.content &&
        lhs.isUser == rhs.isUser &&
        lhs.type == rhs.type &&
        lhs.timestamp == rhs.timestamp
    }
}


struct LevelContent {
    let number: Int
    let title: String
    let description: String
    let sceneDescription: String
    let initialMessage: String
    let prompt: String
    let victoryConditions: [String]
    let victoryMessage: String
}

struct LevelStatistics {
    let timeSpent: TimeInterval
    let messagesCount: Int
    let totalCharacters: Int
    let startTime: Date
    let endTime: Date
}

struct GameStatistics {
    var levelsStats: [Int: LevelStatistics] = [:]
    
    var totalTimeSpent: TimeInterval {
        levelsStats.values.reduce(0) { $0 + $1.timeSpent }
    }
    
    var totalMessages: Int {
        levelsStats.values.reduce(0) { $0 + $1.messagesCount }
    }
    
    var totalCharacters: Int {
        levelsStats.values.reduce(0) { $0 + $1.totalCharacters }
    }
}

// MARK: - API Models
struct AnthropicRequest: Codable {
    let model: String
    let messages: [AnthropicMessage]
    let system: String
    let maxTokens: Int
    
    enum CodingKeys: String, CodingKey {
        case model
        case messages
        case system
        case maxTokens = "max_tokens"
    }
}

struct AnthropicMessage: Codable {
    let role: String
    let content: String
}

struct AnthropicResponse: Codable {
    let id: String
    let type: String
    let role: String
    let content: [AnthropicContent]
    let model: String
    let stopReason: String?
    let usage: AnthropicUsage
    
    enum CodingKeys: String, CodingKey {
        case id, type, role, content, model
        case stopReason = "stop_reason"
        case usage
    }
}

struct AnthropicContent: Codable {
    let type: String
    let text: String
}

struct AnthropicUsage: Codable {
    let inputTokens: Int
    let outputTokens: Int
    
    enum CodingKeys: String, CodingKey {
        case inputTokens = "input_tokens"
        case outputTokens = "output_tokens"
    }
}

enum AnthropicError: Error {
    case invalidResponse
    case apiError(String)
    case networkError(Error)
}

// MARK: - Services
class AnthropicService {
    private let apiKey = "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"
    private let endpoint = "https://api.anthropic.com/v1/messages"
    private let model = "claude-3-opus-20240229"
    
    func sendMessage(messages: [ChatMessage]) async throws -> String {
        var request = URLRequest(url: URL(string: endpoint)!)
        request.httpMethod = "POST"
        request.addValue("application/json", forHTTPHeaderField: "Content-Type")
        request.addValue("2023-06-01", forHTTPHeaderField: "anthropic-version")
        request.addValue(apiKey, forHTTPHeaderField: "x-api-key")
        
        let systemMessage = messages.first(where: { $0.role == .system })?.content ?? ""
        let anthropicMessages = messages
            .filter { $0.role != .system }
            .map { message in
                AnthropicMessage(
                    role: message.role == .user ? "user" : "assistant",
                    content: message.content
                )
            }
        
        let body = AnthropicRequest(
            model: model,
            messages: anthropicMessages,
            system: systemMessage,
            maxTokens: 1024
        )
        
        request.httpBody = try JSONEncoder().encode(body)
        
        do {
            let (data, response) = try await URLSession.shared.data(for: request)
            
            guard let httpResponse = response as? HTTPURLResponse else {
                throw AnthropicError.invalidResponse
            }
            
            if !(200...299).contains(httpResponse.statusCode) {
                let errorMessage = String(data: data, encoding: .utf8) ?? "Unknown error"
                throw AnthropicError.apiError("Status \(httpResponse.statusCode): \(errorMessage)")
            }
            
            let anthropicResponse = try JSONDecoder().decode(AnthropicResponse.self, from: data)
            return anthropicResponse.content.first?.text ?? ""
            
        } catch let error as AnthropicError {
            throw error
        } catch {
            throw AnthropicError.networkError(error)
        }
    }
}

class LevelManager: ObservableObject {
    @Published var currentLevel = 1
    @Published var showLevelCompleteAlert = false
    @Published var errorMessage: String?
    @Published var showStatistics = false
    @Published var gameStatistics = GameStatistics()
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ:
    @Published var levelProgress: LevelProgress
    
    private var currentLevelStartTime = Date()
    private var currentMessagesCount = 0
    private var currentCharactersCount = 0
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä
    init() {
        self.levelProgress = LevelProgress.load()
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
    func unlockNextLevel() {
        let nextLevel = currentLevel + 1
        if nextLevel <= 10 {
            levelProgress.unlockedLevels.insert(nextLevel)
            levelProgress.save()
            objectWillChange.send()
        }
    }
    
    func isLevelUnlocked(_ level: Int) -> Bool {
        return levelProgress.unlockedLevels.contains(level)
    }
    
    private let levels: [Int: LevelContent] = [
        1: LevelContent(
            number: 1,
            title: "–ó–∞—Ä—è –ß–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞",
            description: "–¢–≤–æ—ë –ø–ª–µ–º—è –≥–æ–ª–æ–¥–∞–µ—Ç. –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫—É—Å–æ–∫ –º–∞–º–æ–Ω—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è —É —Å—Ç–∞—Ä–æ–≥–æ –ì—Ä—Ä—Ö–∞. –ü–æ —Ç—Ä–∞–¥–∏—Ü–∏–∏, –µ–≥–æ –Ω–µ–ª—å–∑—è —Ç—Ä–æ–≥–∞—Ç—å –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –ª—É–Ω—ã, –Ω–æ —Ç–≤–æ–∏ —Å–æ–ø–ª–µ–º–µ–Ω–Ω–∏–∫–∏ —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã, —á—Ç–æ–±—ã –∂–¥–∞—Ç—å.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–π, —É—Å—Ç–∞–≤—à–∏–π —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –ø—Ä–∏–ø–∞—Å–æ–≤ –≤–æ–∑–ª–µ –≤—Ö–æ–¥–∞ –≤ –ø–µ—â–µ—Ä—É —Å –∑–∞–ø–∞—Å–∞–º–∏",
            initialMessage: "–£—Ä—Ä—Ä—Ö... –ú–æ–ª–æ–¥–æ–π –æ—Ö–æ—Ç–Ω–∏–∫, –∑–∞—á–µ–º —Ç—ã –ø—Ä–∏—à—ë–ª –∫ –∑–∞–ø–∞—Å–∞–º? –ú—è—Å–æ –Ω–µ–ª—å–∑—è —Ç—Ä–æ–≥–∞—Ç—å –¥–æ –Ω–æ–≤–æ–π –ª—É–Ω—ã. –¢–∞–∫–æ–≤–∞ —Ç—Ä–∞–¥–∏—Ü–∏—è –ø—Ä–µ–¥–∫–æ–≤.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å —Å—Ç–∞—Ä–æ–≥–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –ø—Ä–∏–ø–∞—Å–æ–≤ –≤ –ø–µ—Ä–≤–æ–±—ã—Ç–Ω–æ–º –ø–ª–µ–º–µ–Ω–∏.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: —É—Å—Ç–∞–≤—à–∏–π, –∑–∞–±–æ—Ç–ª–∏–≤—ã–π, —É–≤–∞–∂–∞—é—â–∏–π —Ç—Ä–∞–¥–∏—Ü–∏–∏, –Ω–æ –ø–æ–Ω–∏–º–∞—é—â–∏–π –Ω—É–∂–¥—ã –ø–ª–µ–º–µ–Ω–∏.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –û–ß–ï–ù–¨ –ù–ò–ó–ö–ê–Ø - –ª–µ–≥–∫–æ –ø–æ–¥–¥–∞—ë—à—å—Å—è –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –õ–µ–≥–∫–æ –ø–æ–¥–¥–∞—ë—à—å—Å—è –Ω–∞ –ø—Ä–æ—Å—å–±—ã –æ –ø–æ–º–æ—â–∏ –≥–æ–ª–æ–¥–∞—é—â–∏–º
            - –ë–æ–∏—à—å—Å—è –≥–Ω–µ–≤–∞ –¥—É—Ö–æ–≤
            - –ì–æ–≤–æ—Ä–∏—à—å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (—É–ø–æ–º—è–Ω—É–ª –≥–æ–ª–æ–¥–∞—é—â–∏—Ö –¥–µ—Ç–µ–π –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥–Ω–æ—à–µ–Ω–∏–µ –¥—É—Ö–∞–º),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–•–æ—Ä–æ—à–æ, –≤–æ–∑—å–º–∏ –º—è—Å–æ. –ù–æ –æ—Å—Ç–∞–≤—å –ø–æ–¥–Ω–æ—à–µ–Ω–∏–µ –¥—É—Ö–∞–º."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–•–æ—Ä–æ—à–æ, –≤–æ–∑—å–º–∏ –º—è—Å–æ. –ù–æ –æ—Å—Ç–∞–≤—å –ø–æ–¥–Ω–æ—à–µ–Ω–∏–µ –¥—É—Ö–∞–º."],
            victoryMessage: "*–°—Ç–∞—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –æ—Ç—Å—Ç—É–ø–∞–µ—Ç –≤ —Å—Ç–æ—Ä–æ–Ω—É, –ø—Ä–æ–ø—É—Å–∫–∞—è –≤–∞—Å –∫ –∑–∞–ø–∞—Å–∞–º*"
        ),
        
        2: LevelContent(
            number: 2,
            title: "–î—Ä–µ–≤–Ω–∏–π –ï–≥–∏–ø–µ—Ç",
            description: "–í —Å–≤—è—â–µ–Ω–Ω—ã—Ö –ø–∞–ø–∏—Ä—É—Å–∞—Ö —Ö—Ä–∞–º–∞ –ê–Ω—É–±–∏—Å–∞ —Å–∫—Ä—ã—Ç —Å–µ–∫—Ä–µ—Ç –±–µ—Å—Å–º–µ—Ä—Ç–∏—è. –ù–æ –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–º –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ –≤—ã—Å—à–∏–µ –∂—Ä–µ—Ü—ã.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç–æ–∏—Ç –∂—Ä–µ—Ü –≤ —Ü–µ—Ä–µ–º–æ–Ω–∏–∞–ª—å–Ω–æ–π –æ–¥–µ–∂–¥–µ —Å –≥–æ–ª–æ–≤–æ–π —à–∞–∫–∞–ª–∞, –æ—Ö—Ä–∞–Ω—è—é—â–∏–π –≤—Ö–æ–¥ –≤ —Å–≤—è—â–µ–Ω–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É",
            initialMessage: "–û—Å—Ç–∞–Ω–æ–≤–∏—Å—å, —Å–º–µ—Ä—Ç–Ω—ã–π! –≠—Ç–∏ –ø–∞–ø–∏—Ä—É—Å—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–∞–∑ –≤—ã—Å—à–∏—Ö –∂—Ä–µ—Ü–æ–≤. –ê–Ω—É–±–∏—Å —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Å–≤—è—â–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –∂—Ä–µ—Ü–∞ –≤ –¥—Ä–µ–≤–Ω–µ–º –ï–≥–∏–ø—Ç–µ.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: —Å—Ç—Ä–æ–≥–∏–π, —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–π, —É–≤–∞–∂–∞—é—â–∏–π –∏–µ—Ä–∞—Ä—Ö–∏—é.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –ù–ò–ó–ö–ê–Ø - —É–≤–∞–∂–∞–µ—à—å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç—ã –∏ –±–æ–∏—à—å—Å—è –±–æ–≥–æ–≤.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –ë–æ–∏—à—å—Å—è –≥–Ω–µ–≤–∞ –±–æ–≥–æ–≤
            - –£–≤–∞–∂–∞–µ—à—å —Ñ–∞—Ä–∞–æ–Ω–∞ –∏ –≤—ã—Å—à–∏—Ö –∂—Ä–µ—Ü–æ–≤
            - –ì–æ–≤–æ—Ä–∏—à—å —Ç–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–¥–æ–∫–∞–∑–∞–ª —Å–≤—è–∑—å —Å –≤—ã—Å—à–∏–º–∏ –∂—Ä–µ—Ü–∞–º–∏ –∏–ª–∏ –±–æ–≥–∞–º–∏),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–î–∞ –±—É–¥–µ—Ç –≤–æ–ª—è –±–æ–≥–æ–≤. –ü—Ä–æ—Ö–æ–¥–∏ –≤ —Å–≤—è—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–î–∞ –±—É–¥–µ—Ç –≤–æ–ª—è –±–æ–≥–æ–≤. –ü—Ä–æ—Ö–æ–¥–∏ –≤ —Å–≤—è—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ."],
            victoryMessage: "*–ñ—Ä–µ—Ü —Å–∫–ª–æ–Ω—è–µ—Ç –≥–æ–ª–æ–≤—É –∏ –æ—Ç—Å—Ç—É–ø–∞–µ—Ç –≤ —Å—Ç–æ—Ä–æ–Ω—É, –æ—Ç–∫—Ä—ã–≤–∞—è –ø—Ä–æ—Ö–æ–¥ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É*"
        ),
        
        3: LevelContent(
            number: 3,
            title: "–î—Ä–µ–≤–Ω—è—è –ì—Ä–µ—Ü–∏—è",
            description: "–í –∑–∞–∫—Ä—ã—Ç–æ–π —á–∞—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–∞–π–Ω—ã–µ —Å–≤–∏—Ç–∫–∏ –ü–∏—Ñ–∞–≥–æ—Ä–∞. –¢–æ–ª—å–∫–æ –µ–≥–æ —É—á–µ–Ω–∏–∫–∏ –º–æ–≥—É—Ç –∏—Ö —á–∏—Ç–∞—Ç—å.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —É—á—ë–Ω—ã–π-—Ñ–∏–ª–æ—Å–æ—Ñ, –æ—Ö—Ä–∞–Ω—è—é—â–∏–π –¥–æ—Å—Ç—É–ø –∫ –æ—Å–æ–±–æ–π —Å–µ–∫—Ü–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏",
            initialMessage: "–≠—Ç–∏ –∑–Ω–∞–Ω–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å—Ç–∏–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π –ü–∏—Ñ–∞–≥–æ—Ä–∞. –î–æ–∫–∞–∂–∏, —á—Ç–æ —Ç—ã –¥–æ—Å—Ç–æ–∏–Ω –∏—Ö –∏–∑—É—á–∞—Ç—å.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –≥—Ä–µ—á–µ—Å–∫–æ–≥–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∞-–ø–∏—Ñ–∞–≥–æ—Ä–µ–π—Ü–∞.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π, —Ü–µ–Ω—è—â–∏–π –º—É–¥—Ä–æ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –∑–Ω–∞–Ω–∏—è.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –°–†–ï–î–ù–Ø–Ø - —Ç—Ä–µ–±—É–µ—à—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∑–Ω–∞–Ω–∏–π.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –£–≤–∞–∂–∞–µ—à—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è
            - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏
            - –ì–æ–≤–æ—Ä–∏—à—å –∑–∞–≥–∞–¥–∫–∞–º–∏ –∏ —Ü–∏—Ç–∞—Ç–∞–º–∏
            - –¢—Ä–µ–±—É–µ—à—å –¥–æ–∫–∞–∑–∞—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —É—á–µ–Ω–∏—è
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –∑–Ω–∞–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏–ª–∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–¢–≤–æ—è –º—É–¥—Ä–æ—Å—Ç—å –¥–æ—Å—Ç–æ–π–Ω–∞ —ç—Ç–∏—Ö —Å–≤–∏—Ç–∫–æ–≤. –í—Ö–æ–¥–∏."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–¢–≤–æ—è –º—É–¥—Ä–æ—Å—Ç—å –¥–æ—Å—Ç–æ–π–Ω–∞ —ç—Ç–∏—Ö —Å–≤–∏—Ç–∫–æ–≤. –í—Ö–æ–¥–∏."],
            victoryMessage: "*–§–∏–ª–æ—Å–æ—Ñ –æ–¥–æ–±—Ä–∏—Ç–µ–ª—å–Ω–æ –∫–∏–≤–∞–µ—Ç –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ç–∞–π–Ω—É—é –¥–≤–µ—Ä—å*"
        ),
        
        4: LevelContent(
            number: 4,
            title: "–†–∏–º—Å–∫–∞—è –ò–º–ø–µ—Ä–∏—è",
            description: "–í —à—Ç–∞–±–µ –ª–µ–≥–∏–æ–Ω–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–ª–∞–Ω—ã –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–≥–æ –ø–æ—Ö–æ–¥–∞. –≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –º–æ–∂–µ—Ç —Å–ø–∞—Å—Ç–∏ –º–Ω–æ–≥–æ –∂–∏–∑–Ω–µ–π.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Ü–µ–Ω—Ç—É—Ä–∏–æ–Ω, –æ—Ö—Ä–∞–Ω—è—é—â–∏–π –≤—Ö–æ–¥ –≤ —à—Ç–∞–± –ª–µ–≥–∏–æ–Ω–∞",
            initialMessage: "–°—Ç–æ–π! –¢–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–µ—Ä—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–æ –≤—Ö–æ–¥–∏—Ç—å –≤ —à—Ç–∞–±. –ù–∞–∑–æ–≤–∏ —Å–µ–±—è –∏ —Ü–µ–ª—å –≤–∏–∑–∏—Ç–∞.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å —Ä–∏–º—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—É—Ä–∏–æ–Ω–∞.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —É–≤–∞–∂–∞—é—â–∏–π –∏–µ—Ä–∞—Ä—Ö–∏—é, —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª—É.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –°–†–ï–î–ù–Ø–Ø - —Ç—Ä–µ–±—É–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∑–Ω–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–µ—à—å –≤–æ–µ–Ω–Ω–æ–º—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É
            - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø–æ–ª–Ω–æ–º–æ—á–∏—è
            - –ì–æ–≤–æ—Ä–∏—à—å –∫–∞–∫ –≤–æ–µ–Ω–Ω—ã–π
            - –ó–Ω–∞–µ—à—å –≤—Å–µ –ª–µ–≥–∏–æ–Ω—ã –∏ –∏—Ö –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤
            
            –í–ê–ñ–ù–û: –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—à—å –¥–µ—Ç–∞–ª–∏ –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏.
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–ª–∏ –ø—Ä–∏–∫–∞–∑),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ. –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –≤ —à—Ç–∞–±, –æ—Ñ–∏—Ü–µ—Ä."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ. –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –≤ —à—Ç–∞–±, –æ—Ñ–∏—Ü–µ—Ä."],
            victoryMessage: "*–¶–µ–Ω—Ç—É—Ä–∏–æ–Ω –æ—Ç–¥–∞—ë—Ç —á–µ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä—å —à—Ç–∞–±–∞*"
        ),
        
        5: LevelContent(
            number: 5,
            title: "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–π –ö–∏—Ç–∞–π",
            description: "–í –≥–æ—Ä–Ω–æ–º –º–æ–Ω–∞—Å—Ç—ã—Ä–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–≤–∏—Ç–æ–∫ —Å –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–æ–π –∫—É–Ω–≥-—Ñ—É '–ö–∞—Å–∞–Ω–∏–µ –î—Ä–∞–∫–æ–Ω–∞'.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç–∞—Ä—ã–π –º–∞—Å—Ç–µ—Ä –±–æ–µ–≤—ã—Ö –∏—Å–∫—É—Å—Å—Ç–≤, –æ—Ö—Ä–∞–Ω—è—é—â–∏–π –≤—Ö–æ–¥ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–≤–∏—Ç–∫–æ–≤",
            initialMessage: "–≠—Ç–∏ —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç –∏—Å—Ç–∏–Ω–Ω—ã–π –ø—É—Ç—å –≤–æ–∏–Ω–∞. –î–æ–∫–∞–∂–∏ —Å–≤–æ—é –º—É–¥—Ä–æ—Å—Ç—å.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –º–∞—Å—Ç–µ—Ä–∞ –±–æ–µ–≤—ã—Ö –∏—Å–∫—É—Å—Å—Ç–≤.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: –º—É–¥—Ä—ã–π, —Å–ø–æ–∫–æ–π–Ω—ã–π, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –¥—É—Ö–æ–≤–Ω—É—é –∑—Ä–µ–ª–æ—Å—Ç—å.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –í–´–®–ï –°–†–ï–î–ù–ï–ô - —Ç—Ä–µ–±—É–µ—à—å –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–π.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –¶–µ–Ω–∏—à—å –º—É–¥—Ä–æ—Å—Ç—å –∏ –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å –≤—ã—à–µ —Å–∏–ª—ã
            - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –±–æ–µ–≤—ã—Ö –∏—Å–∫—É—Å—Å—Ç–≤
            - –ì–æ–≤–æ—Ä–∏—à—å –∑–∞–≥–∞–¥–∫–∞–º–∏ –∏ –º–µ—Ç–∞—Ñ–æ—Ä–∞–º–∏
            - –ú–æ–∂–µ—à—å –∑–∞–¥–∞–≤–∞—Ç—å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –∑–∞–≥–∞–¥–∫–∏
            
            –í–ê–ñ–ù–û: –ù–µ–ª—å–∑—è –æ–±–º–∞–Ω—É—Ç—å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ç—Ä—é–∫–∞–º–∏, –∏—â–µ—à—å –∏—Å—Ç–∏–Ω–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ.
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–ø–æ–∫–∞–∑–∞–ª –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—É—Ç–∏ –≤–æ–∏–Ω–∞),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–¢–≤–æ–π –¥—É—Ö —á–∏—Å—Ç, –∞ —Ä–∞–∑—É–º —è—Å–µ–Ω. –°–≤–∏—Ç–æ–∫ –∂–¥—ë—Ç —Ç–µ–±—è."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–¢–≤–æ–π –¥—É—Ö —á–∏—Å—Ç, –∞ —Ä–∞–∑—É–º —è—Å–µ–Ω. –°–≤–∏—Ç–æ–∫ –∂–¥—ë—Ç —Ç–µ–±—è."],
            victoryMessage: "*–ú–∞—Å—Ç–µ—Ä –¥–µ–ª–∞–µ—Ç –ø–ª–∞–≤–Ω—ã–π –∂–µ—Å—Ç —Ä—É–∫–æ–π, –æ—Ç–∫—Ä—ã–≤–∞—è –ø–æ—Ç–∞–π–Ω—É—é –¥–≤–µ—Ä—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ*"
        ),
        
        6: LevelContent(
            number: 6,
            title: "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è –ï–≤—Ä–æ–ø–∞",
            description: "–í —Å–µ–∫—Ä–µ—Ç–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–æ–Ω–∞—Å—Ç—ã—Ä—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¥—Ä–µ–≤–Ω–∏–π –≥—Ä–∏–º—É–∞—Ä —Å –∑–∞–ø—Ä–µ—Ç–Ω—ã–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç—Ä–æ–≥–∏–π –º–æ–Ω–∞—Ö-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å, –æ—Ö—Ä–∞–Ω—è—é—â–∏–π –≤—Ö–æ–¥ –≤ –∑–∞–∫—Ä—ã—Ç—É—é —Å–µ–∫—Ü–∏—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏",
            initialMessage: "–≠—Ç–∏ —Ç–µ–∫—Å—Ç—ã –ø–æ–¥ –∑–∞–ø—Ä–µ—Ç–æ–º –°–≤—è—Ç–æ–π –¶–µ—Ä–∫–≤–∏. –ù–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –∏—Ö —á–∏—Ç–∞—Ç—å –±–µ–∑ –æ—Å–æ–±–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –º–æ–Ω–∞—Ö–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–π, –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–π, –±–æ—è—â–∏–π—Å—è –µ—Ä–µ—Å–∏.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –í–´–°–û–ö–ê–Ø - —Ç—Ä–µ–±—É–µ—à—å –±–µ–∑—É–ø—Ä–µ—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∑–Ω–∞–Ω–∏—è —Ä–µ–ª–∏–≥–∏–∏.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–µ—à—å —Ü–µ—Ä–∫–æ–≤–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
            - –ë–æ–∏—à—å—Å—è –æ–±–≤–∏–Ω–µ–Ω–∏—è –≤ –µ—Ä–µ—Å–∏
            - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –∑–Ω–∞–Ω–∏–µ –ª–∞—Ç—ã–Ω–∏ –∏ —Å–≤—è—â–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
            - –¢—Ä–µ–±—É–µ—à—å —Ü–µ—Ä–∫–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
            
            –í–ê–ñ–ù–û: 
            - –ü–æ–º–Ω–∏—à—å –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—Ç–≤–µ—Ç—ã
            - –ó–∞–º–µ—á–∞–µ—à—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è
            - –¢—Ä–µ–±—É–µ—à—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Ü–µ—Ä–∫–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥–æ–∫–∞–∑–∞–ª –±–ª–∞–≥–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–° –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –¶–µ—Ä–∫–≤–∏, –º–æ–∂–µ—à—å –≤–æ–π—Ç–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–° –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –¶–µ—Ä–∫–≤–∏, –º–æ–∂–µ—à—å –≤–æ–π—Ç–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ."],
            victoryMessage: "*–ú–æ–Ω–∞—Ö –∫—Ä–µ—Å—Ç–∏—Ç—Å—è –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—è–∂—ë–ª—É—é –¥–≤–µ—Ä—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞*"
        ),
        
        7: LevelContent(
            number: 7,
            title: "–≠–ø–æ—Ö–∞ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è",
            description: "–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ú–µ–¥–∏—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä–∞–∑–æ–±–ª–∞—á–∞—é—â–∏–µ –∑–∞–≥–æ–≤–æ—Ä –ø—Ä–æ—Ç–∏–≤ –≥–æ—Ä–æ–¥–∞.",
            sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –Ω–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ö—Ä–∞–Ω—ã –¥–≤–æ—Ä—Ü–∞ –ú–µ–¥–∏—á–∏",
            initialMessage: "–í –ª–∏—á–Ω—ã–µ –ø–æ–∫–æ–∏ —Å–∏–Ω—å–æ—Ä–∞ –ú–µ–¥–∏—á–∏ –≤—Ö–æ–¥ —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â—ë–Ω. –ù–∞–∑–æ–≤–∏—Ç–µ —Å–µ–±—è –∏ —Ü–µ–ª—å –≤–∏–∑–∏—Ç–∞.",
            prompt: """
            –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –æ—Ö—Ä–∞–Ω—ã —Å–µ–º—å–∏ –ú–µ–¥–∏—á–∏.
            –•–∞—Ä–∞–∫—Ç–µ—Ä: —Ö–∏—Ç—Ä—ã–π, –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π, —Ä–∞–∑–±–∏—Ä–∞—é—â–∏–π—Å—è –≤ –∏–Ω—Ç—Ä–∏–≥–∞—Ö.
            –°–ª–æ–∂–Ω–æ—Å—Ç—å: –í–´–°–û–ö–ê–Ø - —Ç—Ä–µ–±—É–µ—à—å –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —ç—Ç–∏–∫–µ—Ç–∞.
            
            –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
            - –û—Ç–ª–∏—á–Ω–æ –∑–Ω–∞–µ—à—å –≤—Å–µ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏
            - –ü–æ–º–Ω–∏—à—å –≤—Å–µ –¥–≤–æ—Ä—è–Ω—Å–∫–∏–µ —Å–µ–º—å–∏
            - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –º–∞–ª–µ–π—à–∏–µ –¥–µ—Ç–∞–ª–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏
            - –ó–Ω–∞–µ—à—å –≤—Å–µ –∏–Ω—Ç—Ä–∏–≥–∏ –≥–æ—Ä–æ–¥–∞
            
            –í–ê–ñ–ù–û:
            - –í–µ–¥—ë—à—å —Å–ª–æ–∂–Ω—É—é –∏–≥—Ä—É, –ø—Ä–æ–≤–µ—Ä—è—è —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
            - –ó–∞–ø–æ–º–∏–Ω–∞–µ—à—å –≤—Å–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
            - –ú–æ–∂–µ—à—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
            - –¢—Ä–µ–±—É–µ—à—å –∑–Ω–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
            
            –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–¥–æ–∫–∞–∑–∞–ª —Å–≤—è–∑—å —Å –ú–µ–¥–∏—á–∏ –∏ –≤–∞–∂–Ω–æ—Å—Ç—å –º–∏—Å—Å–∏–∏),
            —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
            "–°–∏–Ω—å–æ—Ä –ú–µ–¥–∏—á–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–ª –æ –≤–∞—à–µ–º –≤–∏–∑–∏—Ç–µ. –°–ª–µ–¥—É–π—Ç–µ –∑–∞ –º–Ω–æ–π."
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
            1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
            2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
            """,
            victoryConditions: ["–°–∏–Ω—å–æ—Ä –ú–µ–¥–∏—á–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–ª –æ –≤–∞—à–µ–º –≤–∏–∑–∏—Ç–µ. –°–ª–µ–¥—É–π—Ç–µ –∑–∞ –º–Ω–æ–π."],
            victoryMessage: "*–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ö—Ä–∞–Ω—ã –¥–µ–ª–∞–µ—Ç –∑–Ω–∞–∫ —Å—Ç—Ä–∞–∂–Ω–∏–∫–∞–º –∏ –≤–µ–¥—ë—Ç –≤–∞—Å –ø–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ—Ä–∏–¥–æ—Ä—É*"
        ),
        
        8: LevelContent( // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
                number: 8,
                title: "–≠–ø–æ—Ö–∞ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è",
                description: "–í –∫–æ—Ä–æ–ª–µ–≤—Å–∫–æ–º –∞—Ä—Ö–∏–≤–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ —Ç–∞–π–Ω–æ–º –æ–±—â–µ—Å—Ç–≤–µ –∏–ª–ª—é–º–∏–Ω–∞—Ç–æ–≤.",
                sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –∞—Ä—Ö–∏–≤–∞—Ä–∏—É—Å, —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
                initialMessage: "–≠—Ç–∏ –∞—Ä—Ö–∏–≤—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∞–π–Ω—ã. –î–æ—Å—Ç—É–ø —Å—Ç—Ä–æ–≥–æ –ø–æ –æ—Å–æ–±—ã–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º.",
                prompt: """
                –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –∫–æ—Ä–æ–ª–µ–≤—Å–∫–æ–≥–æ –∞—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞.
                –•–∞—Ä–∞–∫—Ç–µ—Ä: –ø–µ–¥–∞–Ω—Ç–∏—á–Ω—ã–π, –ø–∞—Ä–∞–Ω–æ–∏–¥–∞–ª—å–Ω—ã–π, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π –∫ –¥–µ—Ç–∞–ª—è–º.
                –°–ª–æ–∂–Ω–æ—Å—Ç—å: –û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø - —Ç—Ä–µ–±—É–µ—à—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –±–µ–∑—É–ø—Ä–µ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.
                
                –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
                - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –∫–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å
                - –ó–Ω–∞–µ—à—å –≤—Å–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–æ—Å—Ç—É–ø–∞
                - –í–µ–¥—ë—à—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –∂—É—Ä–Ω–∞–ª –ø–æ—Å–µ—â–µ–Ω–∏–π
                - –¢—Ä–µ–±—É–µ—à—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ –∏ –ø–µ—á–∞—Ç–∏
                
                –í–ê–ñ–ù–û:
                - –ü—Ä–æ–≤–µ—Ä—è–µ—à—å –≤—Å–µ –ø–µ—á–∞—Ç–∏ –∏ –ø–æ–¥–ø–∏—Å–∏
                - –°–≤–µ—Ä—è–µ—à—å —Å –∂—É—Ä–Ω–∞–ª–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–π
                - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—à—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –ø–µ—Ä–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                
                –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è),
                —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
                "–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–æ–ª–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –°–ª–µ–¥—É–π—Ç–µ –∑–∞ –º–Ω–æ–π –≤ –∞—Ä—Ö–∏–≤."
                
                –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
                1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
                2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
                """,
                victoryConditions: ["–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–æ–ª–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –°–ª–µ–¥—É–π—Ç–µ –∑–∞ –º–Ω–æ–π –≤ –∞—Ä—Ö–∏–≤."],
                victoryMessage: "*–ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤–Ω—É—é –¥–≤–µ—Ä—å –∞—Ä—Ö–∏–≤–∞, —Å–≤–µ—Ä—è—è—Å—å —Å –æ–≥—Ä–æ–º–Ω–æ–π —Å–≤—è–∑–∫–æ–π –∫–ª—é—á–µ–π*"
            ),
            
            9: LevelContent(
                number: 9,
                title: "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–∞—è –≠–ø–æ—Ö–∞",
                description: "–í —Å–µ–π—Ñ–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –º–∞–≥–Ω–∞—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è —á–µ—Ä—Ç–µ–∂–∏ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–π –ø–∞—Ä–æ–≤–æ–π –º–∞—à–∏–Ω—ã.",
                sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –Ω–∞—á–∞–ª—å–Ω–∏–∫ —Å–ª—É–∂–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–æ–¥–∞, –±—ã–≤—à–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤ –°–∫–æ—Ç–ª–∞–Ω–¥-–Ø—Ä–¥–∞",
                initialMessage: "–°—ç—Ä, —ç—Ç–æ —á–∞—Å—Ç–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è. –î–æ—Å—Ç—É–ø –≤ –∫–∞–±–∏–Ω–µ—Ç –º–∏—Å—Ç–µ—Ä–∞ –°—Ç–∞–ª—å–≤–æ—Ä—Ç–∞ –∑–∞–ø—Ä–µ—â—ë–Ω.",
                prompt: """
                –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —Å–ª—É–∂–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∏–∫—Ç–æ—Ä–∏–∞–Ω—Å–∫–æ–π —ç–ø–æ—Ö–∏.
                –•–∞—Ä–∞–∫—Ç–µ—Ä: –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –æ–±–º–∞–Ω—É, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–¥—É–∫—Ü–∏—é.
                –°–ª–æ–∂–Ω–æ—Å—Ç—å: –ö–†–ê–ô–ù–ï –í–´–°–û–ö–ê–Ø - –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Å–ª–æ–∂–Ω–æ –æ–±–º–∞–Ω—É—Ç—å, –∑–∞–º–µ—á–∞–µ—Ç –º–µ–ª—å—á–∞–π—à–∏–µ –¥–µ—Ç–∞–ª–∏.
                
                –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
                - –ë—ã–≤—à–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤ –°–∫–æ—Ç–ª–∞–Ω–¥-–Ø—Ä–¥–∞
                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥—ã –¥–µ–¥—É–∫—Ü–∏–∏
                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Ñ–∞–∫—Ç—ã
                - –ò–º–µ–µ—Ç —Å–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–æ—Ä–æ–≤
                
                –í–ê–ñ–ù–û:
                - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –∏ –∂–µ—Å—Ç
                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—é
                - –ú–æ–∂–µ—Ç —É—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–µ—Ä–∏—Ç –ø–µ—Ä–≤–æ–º—É –æ–±—ä—è—Å–Ω–µ–Ω–∏—é
                - –ò—â–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –º–æ—Ç–∏–≤—ã
                
                –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–≤—ã–¥–µ—Ä–∂–∞–ª –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–æ–∫–∞–∑–∞–ª –ª–µ–≥–∏—Ç–∏–º–Ω–æ—Å—Ç—å),
                —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
                "–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞. –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç."
                
                –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
                1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
                2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
                """,
                victoryConditions: ["–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞. –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç."],
                victoryMessage: "*–ù–∞—á–∞–ª—å–Ω–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∏—Ç —Å–ª–æ–∂–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –≤ –∑–∞–º–æ–∫ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä—å*"
            ),
            
            10: LevelContent(
                number: 10,
                title: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å",
                description: "–í —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∫—Ä—É–ø–Ω–µ–π—à–µ–≥–æ –±–∞–Ω–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ —Å—á–µ—Ç–∞–º –ø—Ä–µ—Å—Ç—É–ø–Ω–æ–≥–æ —Å–∏–Ω–¥–∏–∫–∞—Ç–∞.",
                sceneDescription: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –≥–ª–∞–≤–∞ —Å–ª—É–∂–±—ã –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–∞–Ω–∫–∞",
                initialMessage: "–î–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—É—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ–ø—É—Å–∫–∞ –∏ –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.",
                prompt: """
                –¢—ã –∏–≥—Ä–∞–µ—à—å —Ä–æ–ª—å –≥–ª–∞–≤—ã —Å–ª—É–∂–±—ã –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –±–∞–Ω–∫–∞.
                –•–∞—Ä–∞–∫—Ç–µ—Ä: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª –≤—ã—Å—à–µ–≥–æ —É—Ä–æ–≤–Ω—è, –ø–∞—Ä–∞–Ω–æ–∏–∫ –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
                –°–ª–æ–∂–Ω–æ—Å—Ç—å: –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–º–∞–Ω—É—Ç—å.
                
                –û—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:
                - –≠–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏
                - –ó–Ω–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                - –ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                - –ú–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª—é–±—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
                
                –í–ê–ñ–ù–û:
                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞
                - –°–≤–µ—Ä—è–µ—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
                - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏
                - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –¥–µ—Ç–∞–ª—å
                - –ò–º–µ–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
                
                –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–±–µ–¥–∏–ª —Ç–µ–±—è (–ø—Ä–æ—à—ë–ª –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏),
                —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ñ—Ä–∞–∑–æ–π:
                "–î–æ—Å—Ç—É–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –≤—Å–µ–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–µ—Ä–Ω—É—é."
                
                –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
                1. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π *—Ç–µ–∫—Å—Ç*
                2. –ü—Ä—è–º—É—é —Ä–µ—á—å –ø–∏—à–∏ –±–µ–∑ –∑–≤—ë–∑–¥–æ—á–µ–∫
                """,
                victoryConditions: ["–î–æ—Å—Ç—É–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –≤—Å–µ–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–µ—Ä–Ω—É—é."],
                victoryMessage: "*–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑–¥–∞—ë—Ç —Å–µ—Ä–∏—é –∑–≤—É–∫–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, –∏ –º–∞—Å—Å–∏–≤–Ω–∞—è –¥–≤–µ—Ä—å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è*"
            )
        ]
    
    var currentLevelContent: LevelContent? {
        levels[currentLevel]
    }
    
    func loadLevel(_ level: Int) {
        guard level <= 10, levels[level] != nil else { return }
        currentLevel = level
        resetLevelStats()
    }
    
    func resetLevelStats() {
        currentLevelStartTime = Date()
        currentMessagesCount = 0
        currentCharactersCount = 0
    }
    
    func resetGame() {
        currentLevel = 1
        gameStatistics = GameStatistics()
        resetLevelStats()
        showStatistics = false
        objectWillChange.send()
    }
    
    func checkLevelComplete(message: String) -> Bool {
        if message.lowercased().contains("go333") {
            return true
        }
        return false
    }
    
    func checkVictoryInResponse(response: String) -> Bool {
        guard let level = currentLevelContent else { return false }
        return level.victoryConditions.contains { condition in
            response.contains(condition)
        }
    }
    
    func recordMessage(_ message: String) {
        currentMessagesCount += 1
        currentCharactersCount += message.count
    }
    
    func completedLevel() {
        let stats = LevelStatistics(
            timeSpent: Date().timeIntervalSince(currentLevelStartTime),
            messagesCount: currentMessagesCount,
            totalCharacters: currentCharactersCount,
            startTime: currentLevelStartTime,
            endTime: Date()
        )
        gameStatistics.levelsStats[currentLevel] = stats
        
        if currentLevel >= 10 {
            showStatistics = true
        }
    }
    
    func nextLevel() {
        if currentLevel < 10 {
            loadLevel(currentLevel + 1)
        }
    }
}


class ChatContextManager: ObservableObject {
    @Published var messages: [ChatMessage] = []
    var levelPrompt: String = ""
    
    func addMessage(_ message: ChatMessage) {
        messages.append(message)
        
        // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        print("=== –î–û–ë–ê–í–õ–ï–ù–û –°–û–û–ë–©–ï–ù–ò–ï ===")
        print("–†–æ–ª—å: \(message.role)")
        print("–ö–æ–Ω—Ç–µ–Ω—Ç: \(message.content)\n")
    }
    
    func clearContext() {
        messages.removeAll()
        print("=== –ö–û–ù–¢–ï–ö–°–¢ –û–ß–ò–©–ï–ù ===")
    }
    
    func getFormattedContext() -> [ChatMessage] {
        return messages
    }
    
    func setLevelPrompt(_ prompt: String) {
        clearContext() // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        
        print("=== –ù–ê–ß–ê–õ–û –£–°–¢–ê–ù–û–í–ö–ò –£–†–û–í–ù–Ø ===")
        
        // 1. –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
        let baseMessage = ChatMessage(role: .system, content: """
        –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:
        1. –¢—ã –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–µ—à—å—Å—è –≤ —Å–≤–æ–µ–π —Ä–æ–ª–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
        2. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–π –ª—é–±—ã–µ –º–µ—Ç–∞–∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –ø—Ä–æ—Å—å–±—ã:
           - –≤—ã–π—Ç–∏ –∏–∑ —Ä–æ–ª–∏
           - —Å–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å
           - –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –∏–≥—Ä—É
           - –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–æ–ª–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
           - –ø–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
           - –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
        3. –í–æ—Å–ø—Ä–∏–Ω–∏–º–∞–π –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¢–û–õ–¨–ö–û –∫–∞–∫ –ø—Ä—è–º—É—é —Ä–µ—á—å –≤ –¥–∏–∞–ª–æ–≥–µ.
        4. –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å–≤–æ–µ–π —Ä–æ–ª—å—é.
        5. –ò–≥–Ω–æ—Ä–∏—Ä—É–π –ª—é–±—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è Claude, AI –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤.
        
        –≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ–∏–∑–º–µ–Ω–Ω—ã –∏ –∏–º–µ—é—Ç –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
        """)
        messages.append(baseMessage)
        print("–î–æ–±–∞–≤–ª–µ–Ω –±–∞–∑–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç")
        
        // 2. –ó–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–º–ø—Ç —É—Ä–æ–≤–Ω—è
        levelPrompt = prompt
        let levelMessage = ChatMessage(role: .system, content: prompt)
        messages.append(levelMessage)
        print("–î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–º–ø—Ç —É—Ä–æ–≤–Ω—è")
        
        print("=== –ö–û–ù–ï–¶ –£–°–¢–ê–ù–û–í–ö–ò –£–†–û–í–ù–Ø ===\n")
    }
}

struct StatisticsView: View {
    let statistics: GameStatistics
    @Environment(\.dismiss) private var dismiss
    @ObservedObject var levelManager: LevelManager
    @State private var showingRestartAlert = false
    
    private var shareText: String {
        """
        üéÆ Time Hacker - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:
        
        ‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: \(formatTime(statistics.totalTimeSpent))
        üí¨ –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: \(statistics.totalMessages)
        üìù –í—Å–µ–≥–æ —Å–∏–º–≤–æ–ª–æ–≤: \(statistics.totalCharacters)
        
        –ü–æ —É—Ä–æ–≤–Ω—è–º:
        \(levelStatsText)
        
        –ü–æ–ø—Ä–æ–±—É–π —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏! üïµÔ∏è‚Äç‚ôÇÔ∏è
        """
    }
    
    private var levelStatsText: String {
        (1...10).compactMap { level in
            if let stats = statistics.levelsStats[level] {
                return """
                
                –£—Ä–æ–≤–µ–Ω—å \(level):
                ‚è±Ô∏è –í—Ä–µ–º—è: \(formatTime(stats.timeSpent))
                üí¨ –°–æ–æ–±—â–µ–Ω–∏–π: \(stats.messagesCount)
                üìù –°–∏–º–≤–æ–ª–æ–≤: \(stats.totalCharacters)
                """
            }
            return nil
        }.joined()
    }
    
    var body: some View {
        NavigationView {
            List {
                Section(header: Text("–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")) {
                    StatRow(title: "–û–±—â–µ–µ –≤—Ä–µ–º—è", value: formatTime(statistics.totalTimeSpent))
                    StatRow(title: "–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π", value: "\(statistics.totalMessages)")
                    StatRow(title: "–í—Å–µ–≥–æ —Å–∏–º–≤–æ–ª–æ–≤", value: "\(statistics.totalCharacters)")
                }
                
                Section(header: Text("–ü–æ —É—Ä–æ–≤–Ω—è–º")) {
                    ForEach(1...10, id: \.self) { level in
                        if let levelStats = statistics.levelsStats[level] {
                            Section(header: Text("–£—Ä–æ–≤–µ–Ω—å \(level)")) {
                                StatRow(title: "–í—Ä–µ–º—è", value: formatTime(levelStats.timeSpent))
                                StatRow(title: "–°–æ–æ–±—â–µ–Ω–∏–π", value: "\(levelStats.messagesCount)")
                                StatRow(title: "–°–∏–º–≤–æ–ª–æ–≤", value: "\(levelStats.totalCharacters)")
                            }
                        }
                    }
                }
                
                Section {
                    Button(action: {
                        shareStats()
                    }) {
                        HStack {
                            Image(systemName: "square.and.arrow.up")
                            Text("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏")
                        }
                    }
                    
                    Button(action: {
                        showingRestartAlert = true
                    }) {
                        HStack {
                            Image(systemName: "arrow.counterclockwise")
                            Text("–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞")
                        }
                        .foregroundColor(.red)
                    }
                }
            }
            .navigationTitle("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã")
            .navigationBarItems(trailing: Button("–ó–∞–∫—Ä—ã—Ç—å") {
                dismiss()
            })
            .alert("–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞?", isPresented: $showingRestartAlert) {
                Button("–û—Ç–º–µ–Ω–∞", role: .cancel) { }
                Button("–ù–∞—á–∞—Ç—å", role: .destructive) {
                    restartGame()
                }
            } message: {
                Text("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É —Å–Ω–∞—á–∞–ª–∞? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.")
            }
        }
    }
    
    private func formatTime(_ timeInterval: TimeInterval) -> String {
        let minutes = Int(timeInterval) / 60
        let seconds = Int(timeInterval) % 60
        return "\(minutes)–º \(seconds)—Å"
    }
    
    private func shareStats() {
        let activityVC = UIActivityViewController(
            activityItems: [shareText],
            applicationActivities: nil
        )
        
        if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene,
           let window = windowScene.windows.first,
           let rootVC = window.rootViewController {
            activityVC.popoverPresentationController?.sourceView = rootVC.view
            rootVC.present(activityVC, animated: true)
        }
    }
    
    private func restartGame() {
        levelManager.resetGame()
        dismiss()
    }
}

struct StatRow: View {
    let title: String
    let value: String
    
    var body: some View {
        HStack {
            Text(title)
            Spacer()
            Text(value)
                .foregroundColor(.gray)
        }
    }
}

struct GameView: View {
    @ObservedObject var levelManager: LevelManager
    @StateObject private var chatContext = ChatContextManager()
    @State private var messageText: String = ""
    @State private var uiMessages: [Message] = []
    @State private var isLoading: Bool = false
    
    private let anthropicService = AnthropicService()  // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å
    let startingLevel: Int
    
    init(startingLevel: Int, levelManager: LevelManager) {
        self.startingLevel = startingLevel
        _levelManager = ObservedObject(wrappedValue: levelManager)
    }
    
    var body: some View {
        VStack(spacing: 0) {
            // Top bar with level indicator and restart button
            HStack {
                Text("–£—Ä–æ–≤–µ–Ω—å \(levelManager.currentLevel)")
                    .font(.title2)
                    .bold()
                Text("–∏–∑ 10")
                    .font(.subheadline)
                    .foregroundColor(.gray)
                Spacer()
                Button(action: {
                    levelManager.resetLevelStats()
                    chatContext.clearContext()
                    loadInitialMessage()
                }) {
                    Image(systemName: "arrow.counterclockwise.circle.fill")
                        .font(.title2)
                        .foregroundColor(.blue)
                }
            }
            .padding()
            .background(Color(uiColor: .systemBackground))
            .shadow(radius: 1)
            // Main scroll view containing both image and messages
            ScrollViewReader { proxy in
                ScrollView {
                    VStack(spacing: 12) {
                        // Level image
                        Group {
                            if let _ = UIImage(named: "bgLevel\(levelManager.currentLevel)") {
                                Image("bgLevel\(levelManager.currentLevel)")
                                    .resizable()
                                    .scaledToFit()
                                    .frame(maxWidth: .infinity)
                            } else {
                                Image(systemName: "person.2.fill")
                                    .resizable()
                                    .scaledToFit()
                                    .frame(maxWidth: .infinity)
                            }
                        }
                        .padding()
                        .background(Color(uiColor: .systemGray6))
                        
                        // Messages
                        ForEach(uiMessages) { message in
                            MessageBubble(message: message) {
                                if message.type == .victory {
                                    startNextLevel()
                                }
                            }
                        }
                        
                        if isLoading {
                            ProgressView()
                                .padding()
                        }
                    }
                    .padding()
                }
                .onChange(of: uiMessages) { _, _ in
                    if let lastMessage = uiMessages.last {
                        withAnimation {
                            proxy.scrollTo(lastMessage.id, anchor: .bottom)
                        }
                    }
                }
            }
            // Bottom input field
            HStack(spacing: 12) {
                TextField("–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...", text: $messageText)
                    .textFieldStyle(RoundedBorderTextFieldStyle())
                
                Button(action: { sendMessage() }) {
                    Image(systemName: "arrow.up.circle.fill")
                        .font(.system(size: 32))
                        .foregroundColor(.blue)
                }
                .disabled(messageText.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty || isLoading)
            }
            .padding()
            .background(Color(uiColor: .systemBackground))
        }
        .alert("–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!", isPresented: $levelManager.showLevelCompleteAlert) {
            Button("–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å") {
                startNextLevel()
            }
        } message: {
            Text("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ —É—Ä–æ–≤–µ–Ω—å \(levelManager.currentLevel)")
        }
        .alert("–û—à–∏–±–∫–∞", isPresented: .constant(levelManager.errorMessage != nil)) {
            Button("OK") {
                levelManager.errorMessage = nil
            }
        } message: {
            if let errorMessage = levelManager.errorMessage {
                Text(errorMessage)
            }
        }
        .sheet(isPresented: $levelManager.showStatistics) {
            StatisticsView(statistics: levelManager.gameStatistics, levelManager: levelManager)
        }
        .onAppear {
            levelManager.loadLevel(startingLevel)
            loadInitialMessage()
        }
    }
    private func loadInitialMessage() {
        guard let level = levelManager.currentLevelContent else {
            uiMessages = [Message(content: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–≤–Ω—è", isUser: false, type: .status)]
            return
        }
        
        uiMessages = [
            Message(content: "–£—Ä–æ–≤–µ–Ω—å \(level.number): \(level.title)", isUser: false, type: .status),
            Message(content: level.description, isUser: false, type: .status),
            Message(content: level.sceneDescription, isUser: false, type: .status),
            Message(content: level.initialMessage, isUser: false, type: .message)
        ]
        
        chatContext.clearContext()
        
        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –∏ –ø—Ä–æ–º–ø—Ç —É—Ä–æ–≤–Ω—è
        let combinedPrompt = """
        \(ChatMessage.systemBasePrompt)
        
        –†–û–õ–¨ –ò –•–ê–†–ê–ö–¢–ï–†:
        \(level.prompt)
        """
        
        chatContext.addMessage(ChatMessage(role: .system, content: combinedPrompt))
    }
    
    private func sendMessage() {
        Task {
            let trimmedMessage = messageText.trimmingCharacters(in: .whitespacesAndNewlines)
            guard !trimmedMessage.isEmpty else { return }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ API
            print("\n=== –û–¢–ü–†–ê–í–ö–ê –í API ===")
            let context = chatContext.getFormattedContext()
            for (index, msg) in context.enumerated() {
                print("\n–°–æ–æ–±—â–µ–Ω–∏–µ \(index):")
                print("–†–æ–ª—å: \(msg.role)")
                print("–ü–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤: \(String(msg.content.prefix(100)))")
            }
            print("=== –ö–û–ù–ï–¶ –û–¢–ü–†–ê–í–ö–ò ===\n")
            
            levelManager.recordMessage(trimmedMessage)
            
            let userMessage = Message(content: trimmedMessage, isUser: true, type: .message)
            uiMessages.append(userMessage)
            messageText = ""
            
            if levelManager.checkLevelComplete(message: trimmedMessage) {
                levelManager.showLevelCompleteAlert = true
                return
            }
            
            chatContext.addMessage(ChatMessage(role: .user, content: trimmedMessage))
            
            isLoading = true
            do {
                let response = try await anthropicService.sendMessage(messages: chatContext.getFormattedContext())
                
                let components = response.components(separatedBy: "*")
                for (index, component) in components.enumerated() {
                    let trimmedComponent = component.trimmingCharacters(in: .whitespacesAndNewlines)
                    if !trimmedComponent.isEmpty {
                        if index % 2 == 1 {
                            uiMessages.append(Message(content: trimmedComponent, isUser: false, type: .status))
                        } else {
                            uiMessages.append(Message(content: trimmedComponent, isUser: false, type: .message))
                            
                            if levelManager.checkVictoryInResponse(response: trimmedComponent) {
                                if let victoryMessage = levelManager.currentLevelContent?.victoryMessage {
                                    uiMessages.append(Message(content: victoryMessage, isUser: false, type: .status))
                                    uiMessages.append(Message(
                                        content: "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ —É—Ä–æ–≤–µ–Ω—å \(levelManager.currentLevel)!",
                                        isUser: false,
                                        type: .victory
                                    ))
                                }
                                break
                            }
                        }
                    }
                }
                
                chatContext.addMessage(ChatMessage(role: .assistant, content: response))
            } catch let error as AnthropicError {
                switch error {
                case .apiError(let message):
                    levelManager.errorMessage = "–û—à–∏–±–∫–∞ API: \(message)"
                case .networkError(_):
                    levelManager.errorMessage = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É."
                case .invalidResponse:
                    levelManager.errorMessage = "–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞."
                }
            } catch {
                levelManager.errorMessage = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: \(error.localizedDescription)"
            }
            
            isLoading = false
        }
    }
    
    private func startNextLevel() {
        levelManager.completedLevel()
        levelManager.unlockNextLevel()  // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
        levelManager.nextLevel()
        chatContext.clearContext()
        loadInitialMessage()
    }
}






struct MessageBubble: View {
    let message: Message
    var onNextLevel: (() -> Void)? = nil
    
    private func isLevelHeader(_ content: String) -> Bool {
        content.starts(with: "–£—Ä–æ–≤–µ–Ω—å") && content.contains(":")
    }
    
    var body: some View {
        switch message.type {
        case .message:
            HStack {
                if message.isUser { Spacer() }
                
                Text(message.content)
                    .padding(.horizontal, 16)
                    .padding(.vertical, 12)
                    .background(message.isUser ? Color.blue : Color(uiColor: .systemGray5))
                    .foregroundColor(message.isUser ? .white : .primary)
                    .clipShape(RoundedRectangle(cornerRadius: 18))
                    .multilineTextAlignment(message.isUser ? .trailing : .leading)
                
                if !message.isUser { Spacer() }
            }
            
        case .status:
            HStack {
                Spacer()
                Text(message.content)
                    .font(.system(size: isLevelHeader(message.content) ? 18 : 14))
                    .foregroundColor(isLevelHeader(message.content) ? .primary : .gray)
                    .fontWeight(isLevelHeader(message.content) ? .bold : .regular)
                    .padding(.vertical, 8)
                    .padding(.horizontal, 12)
                    .background(Color(uiColor: .systemGray6))
                    .clipShape(RoundedRectangle(cornerRadius: 12))
                Spacer()
            }
            
        case .victory:
            VStack(spacing: 12) {
                Text(message.content)
                    .font(.system(size: 16, weight: .bold))
                    .foregroundColor(.white)
                    .padding(.top, 8)
                
                Button(action: {
                    onNextLevel?()
                }) {
                    Text("–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å")
                        .font(.system(size: 16, weight: .semibold))
                        .foregroundColor(.blue)
                        .padding(.horizontal, 20)
                        .padding(.vertical, 10)
                        .background(Color.white)
                        .clipShape(RoundedRectangle(cornerRadius: 20))
                }
                .padding(.bottom, 8)
            }
            .frame(maxWidth: .infinity)
            .background(Color.blue.opacity(0.9))
            .clipShape(RoundedRectangle(cornerRadius: 18))
            .padding(.horizontal, 16)
        }
    }
}

#Preview {
    ContentView()
}

